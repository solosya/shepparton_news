{% import "partials/quotes.twig" as quotes %}
{{ set(this, 'title', article.title) }}
{{ this.registerLinkTag({rel:'amphtml', href:_AppHelper.getServerUrl(false)~'?amp=1'}) }}

{% set config = _Network.getThemeConfig() %}

{% set pianoScripts  = config['piano']['scripts'] is defined and config['piano']['scripts'] == true ? true : false %}

{% set teadsAdSetting = false %}
{% if article['additionalInfo']['teads'] == "teadsOn" %}
    {% set teadsAdSetting = true %}
{% endif %}

{% set blogInfo = _Blog.getBlog() %}

{# {% set networkData = _Network.getNetworkData() %} #}
{% set networkData = getCache("networkData") %}
{% if (networkData is empty) %}
    {% set networkData = _Network.getNetworkData() %}
    {% set cache = setCache("networkData", networkData, 500) %}
{% endif %}

{# {% set log = _AppHelper.log(article) %} #}
{% set syndication = 'Local Content' %}
{% if article.feed_id != null and article.feed_id starts with 'S-' %}
    {% set syndication = 'National Syndicated' %}
{% elseif article.networkId != networkData.id %}
    {% set syndication = 'Regional Syndicated' %}
{% endif %}



{% set feedId = article.feed_id ? article.feed_id : article.aap_id ? article.aap_id : "" %}



    {# {% set distribution = _Article.getDistributionBlogs(article.id) %}
    {% set break = false %}
    {% for blog in distribution if not break %}
        {% if blog.network_id != networkData.id %}
            {% set syndication = 'Regional Syndicated' %}
            {% set break = true %}
        {% endif %}
    {% endfor %}
{% endif %} #}


{% set site = networkData.title | lower | split(" ")[0] %}

{% set ArticleContent = article.content %}
{% set pianoActive = false %}

{# The folling splits up the article content and places divs for Oovvuu videos in
at certain points.  1st video after 3 paragraphs.  2nd video after 4 more paragraphs
and 3rd video at the end if there's been at least 5 paragraphs since the last video #}
{% if site != 'country' and site != 'dairy' %}
    {# {% set videoDivs = [
        "<div id='head-video'></div></p>",
        "<div id='fourth-par-video'></div></p>",
        "<div id='foot-video'></div></p>"
    ] %} #}

    {% set pianoDivsStart = [
        "</p><div id='pianoArticleContentLockable'><!--Container div surrounding article contents from third paragraph to last paragraph -->"
    ] %}

    {% set ArticleContent = article.content | split('<p>') %}
    {% set lastVideo = (ArticleContent | length > 12) ? true : false %}
    {% for i in 0..ArticleContent | length %}


        {% if i == 2 %}
            {% if config['piano']['paywall'] is defined and config['piano']['paywall'] == true %}
                {% set ArticleContent = ArticleContent | slice(0, i) | merge(pianoDivsStart) | merge( ArticleContent | slice(i, ArticleContent | length )) %}
                {% set pianoActive = true %}
            {% endif %}
        {% endif %}

    {% endfor %}

    {% set ArticleContent = ArticleContent | join('<p>') %}




{% elseif site == 'country' %}
    {% set pianoDivsStart = [
        "</p><div id='pianoArticleContentLockable'><!--Container div surrounding article contents from third paragraph to last paragraph -->"
    ] %}

    {% set ArticleContent = article.content | split('<p>') %}
    {% for i in 0..ArticleContent | length %}
        {% if i == 3 %}
            {% if config['piano']['paywall'] is defined and config['piano']['paywall'] == true %}
                {% set ArticleContent = ArticleContent | slice(0, i) | merge(pianoDivsStart) | merge( ArticleContent | slice(i, ArticleContent | length )) %}
                {% set pianoActive = true %}
            {% endif %}
        {% endif %}
    {% endfor %}


    {% set ArticleContent = ArticleContent | join('<p>') %}

{% endif %}
{# end Oovvuu #}







{% set articleImg = false %}
{% set imageToggle = false %}
{% set featured = false %}
{% set videos = [] %}
{% set images = [] %}

{% if article.media|length > 0 %}
    {% set articleImg = _Media.getMediaUrl(article.media[0],1094, 515, {'crop': 'fill', 'gravity': 'faces'} ) %}

    {% set featured = article.media[0].type %}

    {# seperate videos and images into seperate arrays #}
    {% for image in article.media %}
        {% if image.type == 'image' or image.type == 'doc' %}
            {% set images = images|merge([image]) %}
        {% endif %}
        {% if image.type == 'video' %}
            {% set videos = videos|merge([image]) %}
        {% endif %}

    {% endfor %}
{% endif %}

{# Only need the image/video toggle if both exist #}
{% if images|length > 0 and videos|length > 0 %}
    {% set imageToggle = true %}
{% endif %}


{% set publishDate = _AppHelper.getDefaultTimezoneDateTime(article.publishedDate, 'F, Y') %}
{% set pianoPublishDate = _AppHelper.getDefaultTimezoneDateTime(article.publishedDateTime, 'Y-m-d') %}
{% set pianoPublishTime = _AppHelper.getDefaultTimezoneDateTime(article.publishedDateTime, 'G:i:s') %}
{% set pianoTime = pianoPublishDate ~ "T" ~ pianoPublishTime %}


{% set relatedArticles = getCache("articleRelated"~article.blog.id) %}
{% if (relatedArticles is empty) %}
    {% set relatedArticles = _Article.getPopularArticles({ blogId: article.blog.id, limit: 3, interval: 168 }) %}
    {% set cache = setCache("articleRelated"~article.blog.id, relatedArticles, 500) %}
{% endif %}

{% set recentArticles = getCache("articleRecent") %}
{% if (recentArticles is empty) %}
    {% set recentArticles = _Article.getRecentArticles({ limit: 5 }) %}
    {% set cache = setCache("articleRecent", recentArticles, 500) %}
{% endif %}


{# The below are used for Google analytics #}
{% set incites = 'no' %}
{% if article.additionalInfo is defined and article.additionalInfo.incites is defined and article.additionalInfo.incites != null %}
    {% set incites = article.additionalInfo.incites %}
{% endif %}
{% set atexCategories = "" %}
{% if article.additionalInfo is defined and article.additionalInfo.categories is defined and article.additionalInfo.categories != null %}
    {% set atexCategories = article.additionalInfo.categories %}
{% endif %}



{% set testCount = 0 %}
{% set premium = 'Free' %}

{# {% if blogInfo['additionalInfo']['premium'] is defined %}
    {% if blogInfo['additionalInfo']['premium'] == "Premium" %}
        {% set premium = 'Premium' %}
    {% elseif blogInfo['additionalInfo']['premium'] == "Free" %}
        {% set premium = 'Free' %}
    {% endif %}
{% endif %} #}

{% set premiumtags = false %}
{% if config['Premium Tags'] is defined %}
    {% set premiumtags = config['Premium Tags'] %}
{% endif %}

{# Override the above is premium content is set directly on the article #}
{% if article['additionalInfo']['premium'] is defined %}
    {% if article['additionalInfo']['premium'] == "Premium" %}
        {% set premium = 'Premium' %}
    {% endif %}
{% endif %}

{% if article['premiumContent'] %}
    {% set premium = 'Premium' %}
{% endif %}



{# The following for for Piano #}
{% set delimiter = "1111-" %}
{% set url = _AppHelper.getParsedUrl %}
{% set path = url.path | split("/") | last %}
{% set contentCategory = [premium | lower] %}

{% if delimiter in path %}
    {% set categories = path | split(delimiter) | first %}
    {% set category = categories | split("-") %}
    {% set contentCategory = category | merge(contentCategory) %}
{% endif %}

{% set articleNative = "true" %}

{% if 'AAP' in article.label %}
    {% set articleNative = "false" %}
{% endif %}

{% set categoryString = contentCategory | join('", "') %}
{% set pianoAuthor =  article.createdBy['displayName'] %}





<meta name="__sync_contentCategory" content="{{premium}}">

<main id="main" class="container" role="main" data-world="hello">
    <article id="article-content" class="article-main" data-id="{{article.id}}" data-status="{{article.status}}">


            <div class="page-content">
                <div class="row" >
                    <div class="col-md-8" id="articleContentContainer">

                        <div class="row">

                            <div class="col-md-12">

                                <div class="content-block-top">
                                    <div id="pianoArticleHeader"></div>
                                    <!-- For articles tagged as premium include premium article identifier HTML here â€“ currently being designed -->

                                    <a href="{{blogInfo.url}}"><p class="category {{site}}{% if premiumtags and premium == 'Premium' %} premium-tag{% endif %}" >{{article.label}}</p
                                    ></a><time datetime="{{publishedDate}}">{{article.publishedDate}}</time>
                                    {% if _User.isAdminUser() %}
                                        <span style="float:right;color:#a9a9a9;font-size:13px;position:relative;top:6px;">Article id: {{feedId}}</span>
                                    {% endif %}

                                    <h1 id="article-title">{{ quotes.smarten(article.title) }}</h1>

                                    <a class="author" href="{{_AppHelper.getUserProfileUrl(article.createdBy['username'])}}/posts"><span>By</span> {{ article.createdBy['displayName'] }}</a>
                                    <div class="article-social article-social__desktop visible-md-block visible-lg-block">
                                        <a href="https://www.facebook.com/sharer/sharer.php?u={{article.url}}&title={{ article.title|url_encode }}" class="social-icon facebook-icon">
                                            <svg class="svg-icons {{site}} article-social__icons">
                                                <path fill-rule="evenodd" d="M5.893 6.223V4.59c0-.248.013-.441.04-.579.029-.137.084-.268.166-.392a.69.69 0 0 1 .393-.27c.18-.055.42-.082.724-.082h1.633V0H6.223C4.707 0 3.62.359 2.957 1.075c-.662.717-.993 1.778-.993 3.184v1.964H0V9.49h1.964V19h3.929V9.49h2.625l.352-3.267H5.893z"/>
                                            </svg>
                                        </a
                                        ><a href="https://twitter.com/share?text={{ article.title|url_encode }}&url={{article.url}}" class="social-icon twitter-icon">
                                            <svg class="svg-icons {{site}} article-social__icons">
                                                <path fill-rule="evenodd" d="M17.367 2.509a3.954 3.954 0 0 0 1.77-2.218 7.817 7.817 0 0 1-2.554.986C15.775.425 14.79 0 13.624 0c-1.12 0-2.077.395-2.868 1.187-.792.792-1.187 1.748-1.187 2.869 0 .299.029.604.089.918a11.229 11.229 0 0 1-4.64-1.255A11.667 11.667 0 0 1 1.345.74c-.373.627-.56 1.3-.56 2.017 0 .717.164 1.366.493 1.95.329.582.77 1.06 1.322 1.434a4.098 4.098 0 0 1-1.815-.516c-.015 1.03.292 1.89.919 2.622a4.102 4.102 0 0 0 2.33 1.39 4.14 4.14 0 0 1-1.053.134c-.24 0-.493-.022-.762-.068a4.075 4.075 0 0 0 1.434 1.996 3.896 3.896 0 0 0 2.353.806c-1.464 1.15-3.137 1.726-5.02 1.726-.358 0-.686-.016-.985-.046C1.882 15.394 3.95 16 6.207 16c1.434.016 2.78-.208 4.033-.671 1.255-.464 2.33-1.068 3.227-1.815a11.42 11.42 0 0 0 2.308-2.623 11.949 11.949 0 0 0 1.435-3.114c.314-1.076.47-2.16.47-3.25 0-.224-.007-.396-.022-.515a8.124 8.124 0 0 0 2.017-2.084s-1.532.493-2.308.582z"/>
                                            </svg>
                                        </a
                                        ><a href="mailto:?subject=Check%20out%20this%20article&body={{article.url}}" class="social-icon email-icon">
                                            <svg class="svg-icons {{site}} article-social__icons">
                                                <g transform="translate(-548.000000, -1194.000000)">
                                                    <path d="M548.084,1207.818 L555.182,1200.993 L548.063,1194.903 L548,1195.302 L548,1207.398 C548,1207.482 548.028,1207.622 548.084,1207.818 L548.084,1207.818 Z M556.085,1200.174 L557.03,1200.93 L558.899,1202.463 L560.768,1200.93 L561.713,1200.174 L568.853,1194.063 C568.727,1194.021 568.601,1194 568.475,1194 L549.302,1194 C549.162,1194 549.043,1194.021 548.945,1194.063 L556.085,1200.174 Z M549.302,1208.7 L568.475,1208.7 C568.601,1208.7 568.72,1208.679 568.832,1208.637 L561.671,1201.77 L558.899,1204.017 L556.127,1201.77 L548.966,1208.637 C549.078,1208.679 549.19,1208.7 549.302,1208.7 L549.302,1208.7 Z M569.714,1207.818 C569.756,1207.664 569.777,1207.524 569.777,1207.398 L569.777,1195.302 C569.777,1195.162 569.756,1195.029 569.714,1194.903 L562.616,1200.993 L569.714,1207.818 Z" id="Fill-6"></path>
                                                </g>
                                            </svg>
                                        </a>
                                    </div>
                                    {% if _User.isAdminUser() %}
                                        <a href="#" id="oovvuu-curate" class="" style="margin-left:20px;padding-top:5px">Curate videos</a>
                                        <a href="{{article.editUrl}}" target="_blank" class="" style="margin-left:20px;padding-top:5px">Edit article</a>
                                    {% endif %}

                                </div>

                                <hr class="divide18 visible-md-block visible-lg-block" />

                            </div>

                            {% if articleImg %}
                                <div class="col-md-12">
                                    {% if imageToggle %}
                                        <div id="gallery-toggle" class="gallery-toggle">
                                            <ul class="gallery-toggle__list">
                                                <li data-type="image" class="gallery-toggle__item {% if featured != 'video' %} gallery-toggle__item--selected {% endif %}">Image</li
                                               ><li data-type="video" class="gallery-toggle__item {% if featured == 'video' %} gallery-toggle__item--selected {% endif %}">Video</li>
                                            </ul>
                                        </div>
                                    {% endif %}


                                    <div class="gallery-container relative" data-featured="{{featured}}">

                                        {% if images|length > 0 %}
                                            {% set imageFeature = false %}
                                            {% if featured == 'image' or featured == 'doc' %}
                                                {% set imageFeature = true %}
                                            {% endif %}
                                            {{this.render('partials/gallery.twig', {
                                                media: images,
                                                default: imageFeature,
                                                galleryStyle: 'article'

                                            }) | raw}}
                                        {% endif %}

                                        {% if videos|length > 0 %}
                                            {% set videoFeature = featured == 'video' ? true : false %}

                                            {{this.render('partials/gallery.twig', {
                                                media: videos,
                                                type : 'video',
                                                default: videoFeature,
                                                galleryStyle: 'article'
                                            }) | raw}}
                                        {% endif %}

                                    </div>
                                </div>
                            {% endif %}

                                                {# social icons #}

                            <div class="article-social article-social@sm col-sm-9 visible-sm-block visible-xs-block">
                                <a href="https://www.facebook.com/sharer/sharer.php?u={{article.url}}&title={{ article.title|url_encode }}" class="social-icon facebook-icon">
                                    <svg class="svg-icons {{site}} article-social__icons">
                                        <path fill-rule="evenodd" d="M5.893 6.223V4.59c0-.248.013-.441.04-.579.029-.137.084-.268.166-.392a.69.69 0 0 1 .393-.27c.18-.055.42-.082.724-.082h1.633V0H6.223C4.707 0 3.62.359 2.957 1.075c-.662.717-.993 1.778-.993 3.184v1.964H0V9.49h1.964V19h3.929V9.49h2.625l.352-3.267H5.893z"/>
                                    </svg>
                                </a
                                ><a href="https://twitter.com/share?text={{ article.title|url_encode }}&url={{article.url}}" class="social-icon twitter-icon">
                                    <svg class="svg-icons {{site}} article-social__icons">
                                        <path fill-rule="evenodd" d="M17.367 2.509a3.954 3.954 0 0 0 1.77-2.218 7.817 7.817 0 0 1-2.554.986C15.775.425 14.79 0 13.624 0c-1.12 0-2.077.395-2.868 1.187-.792.792-1.187 1.748-1.187 2.869 0 .299.029.604.089.918a11.229 11.229 0 0 1-4.64-1.255A11.667 11.667 0 0 1 1.345.74c-.373.627-.56 1.3-.56 2.017 0 .717.164 1.366.493 1.95.329.582.77 1.06 1.322 1.434a4.098 4.098 0 0 1-1.815-.516c-.015 1.03.292 1.89.919 2.622a4.102 4.102 0 0 0 2.33 1.39 4.14 4.14 0 0 1-1.053.134c-.24 0-.493-.022-.762-.068a4.075 4.075 0 0 0 1.434 1.996 3.896 3.896 0 0 0 2.353.806c-1.464 1.15-3.137 1.726-5.02 1.726-.358 0-.686-.016-.985-.046C1.882 15.394 3.95 16 6.207 16c1.434.016 2.78-.208 4.033-.671 1.255-.464 2.33-1.068 3.227-1.815a11.42 11.42 0 0 0 2.308-2.623 11.949 11.949 0 0 0 1.435-3.114c.314-1.076.47-2.16.47-3.25 0-.224-.007-.396-.022-.515a8.124 8.124 0 0 0 2.017-2.084s-1.532.493-2.308.582z"/>
                                    </svg>
                                </a
                                ><a href="mailto:?subject=Check%20out%20this%20article&body={{article.url}}" class="social-icon email-icon">
                                    <svg class="svg-icons {{site}} article-social__icons">
                                        <g transform="translate(-548.000000, -1194.000000)">
                                            <path d="M548.084,1207.818 L555.182,1200.993 L548.063,1194.903 L548,1195.302 L548,1207.398 C548,1207.482 548.028,1207.622 548.084,1207.818 L548.084,1207.818 Z M556.085,1200.174 L557.03,1200.93 L558.899,1202.463 L560.768,1200.93 L561.713,1200.174 L568.853,1194.063 C568.727,1194.021 568.601,1194 568.475,1194 L549.302,1194 C549.162,1194 549.043,1194.021 548.945,1194.063 L556.085,1200.174 Z M549.302,1208.7 L568.475,1208.7 C568.601,1208.7 568.72,1208.679 568.832,1208.637 L561.671,1201.77 L558.899,1204.017 L556.127,1201.77 L548.966,1208.637 C549.078,1208.679 549.19,1208.7 549.302,1208.7 L549.302,1208.7 Z M569.714,1207.818 C569.756,1207.664 569.777,1207.524 569.777,1207.398 L569.777,1195.302 C569.777,1195.162 569.756,1195.029 569.714,1194.903 L562.616,1200.993 L569.714,1207.818 Z" id="Fill-6"></path>
                                        </g>
                                    </svg>
                                </a>
                            </div>


                            <div class="col-md-12 u-margin-top-40 u-mobile-margin-top-20">

                                <div class="hidden" id="oovvuu"> {{oovvuu}}</div>
                                <div class="hidden" id="brightcove"> {{networkData.thirdPartyIntegrations.Brightcove.id}}</div>

                                <div class="article_content {{site}}" id="articleContent">
                                    {{ ArticleContent | _resizeImages({'width': 600}) | raw }}
                                    {% if pianoActive %}
                                        </div>
                                        <div id='pianoArticleContentFooter'></div>
                                    {% endif %}
                                </div><!-- .content-->

                            </div>
                        </div>
                    </div>


                    <div class="col-md-4 visible-md-block visible-lg-block" style="min-height:1px;" id="adScrollContainer">
                        <div class="article-sidebar lockad-top u-left-unset u-fix-width-300" id="articleAdScroll">
                            <div class="">

                                <div class="ad-side-container">
                                    <div class='advert-desktop u-fix-adsize' data-adsize="mrec"></div>
                                </div>
                            </div>
                            <div class="">
                                {% if recentArticles[0] %}<h2 class="sidebar-header {{site}}">Latest articles</h2>{% endif %}

                                {% if config['newsletter'] is defined and config['newsletter'] != "" %}
                                    {% for i in 0..1 if recentArticles[i] %}

                                            {{this.render('partials/_single-article.twig', {
                                                article: recentArticles[i],
                                                imageSuppress: false,
                                                containerClass: 'feature-side feature-side-tablet card-sm-mobile',
                                                site:   site
                                            }) | raw}}

                                            {% if i < 2 %}
                                                <hr class="divide15">
                                            {% endif %}

                                    {% endfor %}
                                    <div class=" col-sm-4 col-md-12">
                                        <div class="newsletter-iframe-container" style="display: flex;flex-direction: column;overflow: hidden;margin: 0 -15px;">
                                            <iframe src="{{config['newsletter']}}" class="newsletter-iframe" id="newsletter-iframe" style="flex-grow: 1;border: none;margin: 0;padding: 0;height: 95px;"></iframe>
                                        </div>
                                    </div>
                                {% else %}
                                    {% for i in 0..2 if recentArticles[i] %}

                                            {{this.render('partials/_single-article.twig', {
                                                article: recentArticles[i],
                                                imageSuppress: false,
                                                containerClass: 'feature-side feature-side-tablet card-sm-mobile',
                                                site:   site
                                            }) | raw}}

                                            {% if i < 2 %}
                                                <hr class="divide15">
                                            {% endif %}

                                    {% endfor %}
                                {% endif %}

                            </div>
                        </div>
                    </div>


                    <div class="col-sm-12 visible-xs-block visible-sm-block u-margin-top-30">
                        <div class="article-sidebar-device">


                            <div class="ad-side-container hidden-sm u-mobile-margin-top-15" style="height:250px;position:relative;width:300px;margin: 0 auto;">
                                <div class='advert-mobile' data-adsize="mrec"></div>
                            </div>
                            <div class='advert-tablet visible-sm-block u-tablet-margin-top-30' data-adsize="banner"></div>

                            {% if recentArticles[0] %}<h2 class="sidebar-header {{site}}">Latest articles</h2>{% endif %}

                            {% if config['newsletter'] is defined and config['newsletter'] != "" %}
                                {% for i in 0..2 if recentArticles[i] %}
                                    <div class="col-md-9 col-sm-6">
                                        {{this.render('partials/_single-article.twig', {
                                            article: recentArticles[i],
                                            imageSuppress: false,
                                            containerClass: 'feature-side feature-side-tablet card-sm-mobile',
                                            site:   site
                                        }) | raw}}

                                        {% if i < 4 %}
                                            <hr class="divide15">
                                        {% endif %}
                                    </div>
                                {% endfor %}
                                <div class="col-sm-6 col-md-12 col-xs-12">
                                    <div class="newsletter-iframe-container" style="display: flex;flex-direction: column;overflow: hidden;margin: 0 -15px;padding: 0 15px;">
                                        <iframe src="{{config['newsletter']}}" class="newsletter-iframe" id="newsletter-iframe" style="flex-grow: 1;border: none;margin: 0;padding: 0;height: 95px;"></iframe>
                                    </div>
                                </div>
                            {% else %}
                                {% for i in 0..3 if recentArticles[i] %}
                                    <div class="col-md-12 col-sm-6">
                                        {{this.render('partials/_single-article.twig', {
                                            article: recentArticles[i],
                                            imageSuppress: false,
                                            containerClass: 'feature-side feature-side-tablet card-sm-mobile',
                                            site:   site
                                        }) | raw}}

                                        {% if i < 4 %}
                                            <hr class="divide15">
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% endif %}


                        </div>

                    </div><!-- .article-sidebar-->

                </div>

            </div><!-- .page-content-->

            <!-- Disqus Comment Added -->
            {% if networkData.thirdPartyIntegrations['disqus'] | length > 0 and networkData.thirdPartyIntegrations['disqus']['shortName'] != '' %}
                {{this.render("partials/article/_disqus_comments.twig", {disqus: networkData.thirdPartyIntegrations['disqus'], userId: article.createdBy['id'], url:article.url, articleId: article.id}) | raw}}
            {% endif %}


            <div class="row related-articles">
                <div class="col-md-12">
                    <h1>MOST POPULAR</h1>
                </div>

                <div class="">
                    <div class="row">
                        {% for i in 0..2 if relatedArticles[i] %}
                            <div class="col-sm-4">
                                {{this.render('partials/_single-article.twig', {
                                    article: relatedArticles[i],
                                    imageSize: {width: 300, height: 180},
                                    containerClass: 'card-sm-wide card-sm-wide-tablet card-sm-wide-mobile',
                                    site:   site
                                }) | raw}}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>


            {# <iframe allowfullscreen="" mozallowfullscreen="" src="//players.brightcove.net/5370537724001/HkEx1WOvW_default/index.html?videoId=5741664695001" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; width: 100%; height: 100%;" webkitallowfullscreen=""></iframe> #}



    </article>
</main><!--site-main-->
<div class='advert-desktop advert-mobile advert-tablet' data-adsize="teads"></div>
{# <div class='advert-desktop advert-mobile advert-tablet' data-adsize="teads"></div> #}
<div class='advert-desktop advert-tablet' data-adsize="interstitial"></div>
<div class='advert-desktop advert-tablet' data-adsize="interstitial"></div>




<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        Acme.articleController = Acme.ArticleController();
        {% if article['additionalInfo']['teads'] == "teadsOff" %}
            Acme.articleController.InsertInterstitial(false);
        {% else %}
            Acme.articleController.InsertInterstitial(true);
        {% endif %}
        Acme.galleryToggle = new Acme.GalleryToggle();
    });
</script>

{% if config['newsletter'] is defined and config['newsletter'] != "" %}
    <script>

        ga(function(tracker) {
            // Gets the client ID of the default tracker.
            var clientId = tracker.get('clientId');
            // Gets a reference to the window object of the destination iframe.
            var frameWindow = document.getElementById('newsletter-iframe').contentWindow;
            // Sends the client ID to the window inside the destination frame.
            frameWindow.postMessage(clientId, '{{config['newsletter']}}');
        });
    </script>
{% endif %}



{% if pianoScripts == true %}
    {{ this.render('layouts/partials/pianoscript.twig', {
        pageLayout: "article",
        author: article.createdBy['displayName'],
        premium:premium,
        incites: incites,
        categories: atexCategories,
        syndication: syndication,
        site:site,
    }) | raw }}

{% else %}
    <script>
        sendPageView({
            "author": "{{ article.createdBy['displayName'] }}",
            "articleStatus" : "{{premium}}",
            "incites" : "{{incites}}",
            "categories" : "{{atexCategories}}",
            "syndication" : "{{syndication}}",
        });
    </script>
{% endif %}



<script>
    document.addEventListener("DOMContentLoaded", function(event) {

        var articleCompleted = false;

        $(window).scroll(function() {
            if(!articleCompleted && $(window).scrollTop() + $(window).height() > document.getElementById('articleContentContainer').offsetTop + document.getElementById('articleContentContainer').offsetHeight) {
                payWallFound = false;
                articleContentIFrames = document.getElementById('pianoArticleContentLockable').getElementsByTagName('iFrame');
                for (let i = 0; i < articleContentIFrames.length; i++) {
                    if (articleContentIFrames[i].getAttribute('src') && articleContentIFrames[i].getAttribute('src').startsWith('https://buy-au.piano.io/')) {
                        payWallFound = true;
                    }
                }

                if(!payWallFound) {
                    articleCompleted = true;
                    ga('send', {
                        hitType: 'event',
                        eventCategory: 'articleComplete',
                        eventAction: 'articleScrolledToCompletion',
                        nonInteraction: true
                    });
                }
            }
        });
    });

</script>



