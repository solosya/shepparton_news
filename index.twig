{{ set(this, 'title', _Blog.getBlogTitle()) }}
{% set networkData = _Network.getNetworkData() %}
{% set blogData    = _Blog.getBlog() %}
{% set layout      = blogData.layout %}
{% set site        = networkData.title | lower | split(" ")[0]%}
{# {% set site        =  'country' %} #}

{# {% set layoutTitle = _Page.getLayoutTitle() %} #}

{{this.registerJs("Acme.cards = CardController();")}}

{% set templatePath = "window.Acme.templatePath = '" ~ networkData.templatePath ~ "';" %}
{{this.registerJs( templatePath )}}

{% set limit = 15 %}

{% set articlesArr = _Blog.getBlogFeed({'limit': limit, 'offset': 0}) %}
{% set articles = articlesArr.articles %}

{% set date = date() %}
{% set events = _Event.getEvents({"limit": 5, "start_date": date.date | split(" ")[0]}) %}

<!-- used to index each article as we loop over throughout the template -->
{% set articleCount = _AppHelper.getApplicationEnv() == 'DEV' ? 0 : 0 %}
{% set dev = _AppHelper.getApplicationEnv() == 'DEV' ? false : false %}

{% set sections =  {} %}

{% if site | lower == 'shepp' %}
    {% set sections =  {
            "local news": {
                "title": "Local News", "limit" : 6, 'template' : 'partials/index/large-section.twig'
            }, 
            "regional news": {
                "title": "Regional News", "limit" : 5, 'template' : 'partials/index/medium-section.twig'
            },
            "opinion": {
                "title": "Opinion", "limit" : 4, 'template' : 'partials/index/opinion.twig'
            },
            "rural news": {
                "title": "Rural News", "limit" : 3, 'template' : 'partials/index/row-three.twig'
            },
            "sport": {
                "title": "Sport", "limit" : 5, 'template' : 'partials/index/section-with-feature.twig'
            },
            "national": {
                "title": "National", "limit" : 4, 'template' : 'partials/index/row-four.twig'
            },
            "business": {
                "title": "Business", "limit" : 5, 'template' : 'partials/index/medium-section.twig'
            },
            "bloggers": {
                "title": "Bloggers", "limit" : 2, 'template' : 'partials/index/bloggers.twig'
            }
        }
    %}




{% elseif site | lower == 'country' %}
    {% set sections =  {
            "dairy": {
                "title": "Dairy", "limit" : 5, 'template' : ''
            }, 
            "water": {
                "title": "Water", "limit" : 4, 'template' : ''
            },
            "horticulture": {
                "title": "Horticulture", "limit" : 3, 'template' : ''
            },
            "livestock": {
                "title": "Livestock", "limit" : 3, 'template' : ''
            },
            "cropping": {
                "title": "Cropping", "limit" : 3, 'template' : ''
            },
            "videos": {
                "title": "Videos", "limit" : 2, 'template' : ''
            },
            "blogs homepage": {
                "title": "Bloggers", "limit" : 2, 'template' : ''
            },
            "viticulture": {
                "title": "Viticulture",  "limit" : 3, 'template' : ''
            }
        }
    %}

{% endif  %}


{% for key, value in sections %}
    {% for blog in networkData.networkBlogs %}
        {% if blog.title | lower == key %}
            
            {% set feed = dev 
                    ? articlesArr 
                    : _Blog.getBlogFeed({'limit': sections[key]['limit'], 'offset': 0, 'blogid':blog.guid}) 
            %}

            {% set sections = sections | merge({
                (key) : {
                    'feed'   : feed,
                    'link'   : blog.link,
                    'title'  : sections[key]['title']
                    }
                }) %}
        {% endif %}
    {% endfor %}
{% endfor %}



{# First set a common order then add site order to beginning #}
{% set sectionCount = 0 %}
{% set sectionOrder = ["world", "business", "videos", "community"] %}

{% if site == 'shepp' %}
    {% set sectionOrder = ["local news", "bloggers", 'regional news', 'opinion', 'rural news', 'sport'] %}
{% elseif site == 'country' %}
    {% set sectionOrder = ["dairy", "water", 'horticulture', 'livestock', 'cropping', 'videos', 'blogs homepage', 'viticulture'] %}
{% elseif site == 'dairy'  %}
    {% set sectionOrder = ["new zealand", "australia"] | merge(sectionOrder ) %}
{% else %}
    {% set sectionOrder = ["australia", "new zealand"] | merge(sectionOrder ) %}
{% endif %}











<main id="main" class="site-main" role="main">
    


    {# *******************************************************
                Top of Index page n articles
    ******************************************************* #}

    <div class="container">
        {{this.render('partials/index/default-top.twig', {
            articles: articles, 
            articleCount: articleCount,
            dev: dev,
            site: site,
            ad: 'div-gpt-ad-mrec-4',
        }) | raw}}
    </div>





    <div id="newAdSlot"></div>
    <script>loadNextAd()</script>







    {# *******************************************************
                        First section
    ******************************************************* #}




    {% set sectionFeed = sections[ sectionOrder[sectionCount] ] %}
    {% if sectionFeed.feed.articles|length > 0 %}

        {% set temp = sectionFeed.template != '' ? sectionFeed.template : 'partials/index/large-section.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles:       sectionFeed, 
                articleCount:   articleCount,
                title:          sectionFeed.title,
                events:         events,
                dev:            dev,
                site:           site,
                ad: 'div-gpt-ad-halfpage-ss'
            }) | raw}} 
        </div>
    {% endif %}
    {% set sectionCount = sectionCount + 1 %}





    <div class="ad-container hidden-md hidden-lg mobad2">
        <div id='div-gpt-ad-mrec-7' class="card__announcement-image google_ad google_ad_mrec text-center" >
            <script type='text/javascript'>
                googletag.cmd.push(function() { googletag.display('div-gpt-ad-mrec-7'); });
            </script>
        </div>
    </div>




    {# *******************************************************
                        Second section
    ******************************************************* #}
    {% set sectionFeed = sections[ sectionOrder[sectionCount] ] %}

    {% if sectionFeed.feed.articles|length > 0 %}
        {% set temp = sectionFeed.template != '' ? sectionFeed.template : 'partials/index/bloggers.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles:       sectionFeed, 
                articleCount:   articleCount,
                title:          sectionFeed.title,
                dev:            dev,
                site:           site,
                logo:           networkData.templatePath ~ '/static/images/megaphone.svg',
                networkData:    networkData
            }) | raw}} 
        </div>
    {% endif %}
    {% set sectionCount = sectionCount + 1 %}






    {# *******************************************************
                        Third section
    ******************************************************* #}

    {% if sections['regional news'].feed.articles|length > 0 %}
        {% set temp = sections['regional news'].template != '' ? sections['regional news'].template : 'partials/index/medium-section.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['regional news'], 
                articleCount: articleCount,
                title: sections['regional news'].title,
                dev: dev,
                site: site,
                ad: 'div-gpt-ad-mrec-1',
            }) | raw}} 
        </div>
    {% endif %}






    <div class="ad-container visible-sm-block">
        <div id='div-gpt-ad-leaderboard-3' class="google_ad google_ad_leaderboard">
            <script type='text/javascript'>
                googletag.cmd.push(function() { googletag.display('div-gpt-ad-leaderboard-3'); });
            </script>
        </div>
    </div>      






    {# *******************************************************
                        Fourth section
    ******************************************************* #}

    {% if sections['opinion'].feed.articles|length > 0 %}
        {% set temp = sections['opinion'].template != '' ? sections['opinion'].template : 'partials/index/opinion.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['opinion'], 
                articleCount: articleCount,
                title: sections['opinion'].title,
                dev: dev,
                site: site,
            }) | raw}} 
        </div>
    {% endif %}








    {# *******************************************************
                        Fifth section
    ******************************************************* #}

    {% if sections['rural news'].feed.articles|length > 0 %}
        {% set temp = sections['rural news'].template != '' ? sections['rural news'].template : 'partials/index/row-three.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['rural news'], 
                articleCount: articleCount,
                title: sections['rural news'].title,
                dev: dev,
                site: site,
                cards: 'card-sm-wide card-sm-wide-tablet card-sm-mobile',
            }) | raw}} 
        </div>
    {% endif %}








    {# *******************************************************
                        Sixth section
    ******************************************************* #}

    {% if sections['national'].feed.articles|length > 0 %}
        {% set temp = sections['national'].template != '' ? sections['national'].template : 'partials/index/row-four.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['national'], 
                articleCount: articleCount,
                title: sections['national'].title,
                dev: dev,
                site: site,
            }) | raw}} 
        </div>
    {% endif %}







    {# *******************************************************
                        Seventh section
    ******************************************************* #}

    {% if sections['sport'].feed.articles|length > 0 %}
        {% set temp = sections['sport'].template != '' ? sections['sport'].template : 'partials/index/section-with-feature.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['sport'], 
                articleCount: articleCount,
                title: sections['sport'].title,
                dev: dev,
                site: site,
                ad: 'div-gpt-ad-mrec-2',
            }) | raw}} 
        </div>
    {% endif %}







    {# *******************************************************
                        Eighth section
    ******************************************************* #}


    {% if sections['business'].feed.articles|length > 0 %}
        {% set temp = sections['business'].template != '' ? sections['business'].template : 'partials/index/medium-section.twig' %}

        <div class="container">
            {{this.render(temp, {
                articles: sections['business'], 
                articleCount: articleCount,
                title: sections['business'].title,
                dev: dev,
                site: site,
                ad: 'div-gpt-ad-mrec-3',                
            }) | raw}} 
        </div>
    {% endif %}



   

</main><!-- .site-main -->



<div id='div-gpt-ad-interstitial' class="hidden-xs">
    <script type='text/javascript'>
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-interstitial'); });
    </script>
</div>


<div id='div-gpt-ad-teads' class="hidden-xs">
    <script type='text/javascript'>
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-teads'); });
    </script>
</div>