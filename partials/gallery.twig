{% set type = type is defined ? type : "image" %}
{% set galleryStyle = galleryStyle is defined ? galleryStyle  : "article" %}
{% set owl      = '' %}
{% set owlClass = '' %}


{% if ( media | length > 1 ) %}
    {% set owl = "owl-gallery-" ~ type %}
    {% set owlClass = 'owl-carousel owl-shep-theme owl-carousel__base'%}
{% endif %}

{% set defaultClass = default is defined and default == true ? "default" : "" %}

{# Used for the article gallery to add some caption html #}
{% set caption = html is defined and html != '' ? html : false %}



<div id="{{owl}}" class="article-gallery owl-gallery-{{type}} {{owlClass}} {{defaultClass}}" data-slider-id="1" data-default="{{default}}">
    {% for image in media %}
        {% set articleImg = _Media.getMediaUrl(image, 0, 515, {'crop': 'fill', 'gravity': 'auto'} ) %}

        <figure class="article-gallery__image article-gallery__image-{{galleryStyle}}" data-hash="{{loop.index}}">
                
            {% if image.type == 'image' or image.type == 'doc'%} 

                <img src="{{articleImg}}" class="article-gallery__img {{galleryStyle}}-featured-image__img">

            {% endif %}                
            
            
            {% if image.type == 'video' %} 
                
                {% set mediaUrl = "" %}
                
                {% if image.isSystemVideo == 'TRUE'%}
                    
                    {% set mediaUrl = _Media.getMediaVideoUrl(image, 0, 0,{resource_type: 'video', format: 'mp4'})  %}

                    <video controls class="article-video" poster="{{image.path}}">
                        <source src="{{mediaUrl}}" type="video/mp4"/>
                    </video>
                
                {% else %}

                    {% if image.source == 'youtube' %}
                        {% set mediaUrl = "//www.youtube.com/embed/" ~ image.videoId  %}
                    
                    {% elseif image.source == 'vimeo' %}
                        {% set mediaUrl = "//player.vimeo.com/video/" ~ image.videoId  %}
                    
                    {% elseif image.source == 'brightcove' %}
                        {% set videoId      = image.videoId | split("::")[0]  %}
                        {% set accountID    = image.videoId | split("::")[1]  %}
                        {% set playerID     = image.videoId | split("::")[2]  %}
                        {% set mediaUrl = "//players.brightcove.net/" ~ accountID ~ "/" ~ playerID ~ "_default/index.html?videoId=" ~ videoId ~ "&playsinline"  %}
                    {% endif %}


                    <iframe src="{{mediaUrl}}" 
                        allowfullscreen
                        webkitallowfullscreen
                        mozallowfullscreen
                        style="width: 100%; height: 100%; top: 0px; bottom: 0px; right: 0px; left: 0px;">
                    </iframe>
    
                {% endif %}

            {% endif %}

           
 
            <figcaption  style="float:unset;">
                <p class="{{galleryStyle}}-featured-image__caption">{{image.caption}}</p>
                <p class="{{galleryStyle}}-featured-image__caption-count">{{loop.index}} of {{loop.revindex + loop.index0}}</p>
            </figcaption>


        </figure>
    {% endfor %}
</div>